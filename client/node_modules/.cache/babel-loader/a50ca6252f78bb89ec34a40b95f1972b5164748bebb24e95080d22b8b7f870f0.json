{"ast":null,"code":"import React,{useState,useContext,useEffect}from'react';import{Container,Form,Button,Alert,Card,Row,Col}from'react-bootstrap';import{useNavigate}from'react-router-dom';import{AuthContext}from'../context/AuthContext';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL='http://localhost:5000/api';const KycSubmission=()=>{const{user,setUser}=useContext(AuthContext);const navigate=useNavigate();const[formData,setFormData]=useState({aadharId:'',panId:'',incomeProofId:''});const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[success,setSuccess]=useState('');// Use effect to handle redirects based on authentication and verification status\nuseEffect(()=>{// Redirect if not logged in\nif(!user){navigate('/login');return;}// Redirect if already verified or pending verification\nif(user.verificationStatus==='verified'||user.verificationStatus==='pending'){navigate('/dashboard');}},[user,navigate]);const handleChange=e=>{setFormData({...formData,[e.target.name]:e.target.value});};const handleSubmit=async e=>{e.preventDefault();if(!formData.aadharId||!formData.panId||!formData.incomeProofId){setError('Please fill in all document ID fields');return;}setLoading(true);setError('');try{// Get token from localStorage\nconst token=localStorage.getItem('token');const response=await axios.post(`${API_URL}/users/kyc-simplified`,formData,{headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`}});setSuccess('Document IDs submitted successfully. Your KYC verification is pending review.');// Update the user context with new verification status\nsetUser({...user,verificationStatus:'pending'});// Redirect to dashboard after 3 seconds\nsetTimeout(()=>{navigate('/dashboard');},3000);}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||err.message);}finally{setLoading(false);}};// If auth context is still loading or no user exists, don't render the form yet\nif(!user){return null;}return/*#__PURE__*/_jsx(Container,{className:\"py-5\",children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Header,{as:\"h4\",className:\"text-center bg-primary text-white\",children:\"KYC Verification\"}),/*#__PURE__*/_jsxs(Card.Body,{children:[error&&/*#__PURE__*/_jsx(Alert,{variant:\"danger\",children:error}),success&&/*#__PURE__*/_jsx(Alert,{variant:\"success\",children:success}),/*#__PURE__*/_jsx(Card.Text,{className:\"mb-4\",children:\"To continue with our services, we need to verify your identity. Please provide the following document IDs:\"}),/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(Row,{className:\"mb-4\",children:[/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Aadhar Card Number\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"aadharId\",value:formData.aadharId,onChange:handleChange,placeholder:\"Enter 12-digit Aadhar number\",maxLength:12,required:true}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\",children:\"Your 12-digit unique Aadhar identification number\"})]})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"PAN Card Number\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"panId\",value:formData.panId,onChange:handleChange,placeholder:\"Enter 10-character PAN\",maxLength:10,required:true}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\",children:\"Your 10-character Permanent Account Number\"})]})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Income Proof Reference\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"incomeProofId\",value:formData.incomeProofId,onChange:handleChange,placeholder:\"Enter income document reference\",required:true}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\",children:\"Tax filing number or salary slip reference\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center mt-4\",children:/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",size:\"lg\",disabled:loading||!formData.aadharId||!formData.panId||!formData.incomeProofId,className:\"px-5\",children:loading?'Submitting...':'Submit Document IDs'})})]})]})]})});};export default KycSubmission;","map":{"version":3,"names":["React","useState","useContext","useEffect","Container","Form","Button","Alert","Card","Row","Col","useNavigate","AuthContext","axios","jsx","_jsx","jsxs","_jsxs","API_URL","KycSubmission","user","setUser","navigate","formData","setFormData","aadharId","panId","incomeProofId","loading","setLoading","error","setError","success","setSuccess","verificationStatus","handleChange","e","target","name","value","handleSubmit","preventDefault","token","localStorage","getItem","response","post","headers","setTimeout","err","_err$response","_err$response$data","data","message","className","children","Header","as","Body","variant","Text","onSubmit","md","Group","Label","Control","type","onChange","placeholder","maxLength","required","size","disabled"],"sources":["C:/Users/cpl/Desktop/Cursor/loan-management-system/client/src/pages/KycSubmission.js"],"sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\nimport { Container, Form, Button, Alert, Card, Row, Col } from 'react-bootstrap';\nimport { useNavigate } from 'react-router-dom';\nimport { AuthContext } from '../context/AuthContext';\nimport axios from 'axios';\n\nconst API_URL = 'http://localhost:5000/api';\n\nconst KycSubmission = () => {\n  const { user, setUser } = useContext(AuthContext);\n  const navigate = useNavigate();\n  \n  const [formData, setFormData] = useState({\n    aadharId: '',\n    panId: '',\n    incomeProofId: ''\n  });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState('');\n  \n  // Use effect to handle redirects based on authentication and verification status\n  useEffect(() => {\n    // Redirect if not logged in\n    if (!user) {\n      navigate('/login');\n      return;\n    }\n    \n    // Redirect if already verified or pending verification\n    if (user.verificationStatus === 'verified' || user.verificationStatus === 'pending') {\n      navigate('/dashboard');\n    }\n  }, [user, navigate]);\n  \n  const handleChange = (e) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value\n    });\n  };\n  \n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    if (!formData.aadharId || !formData.panId || !formData.incomeProofId) {\n      setError('Please fill in all document ID fields');\n      return;\n    }\n    \n    setLoading(true);\n    setError('');\n    \n    try {\n      // Get token from localStorage\n      const token = localStorage.getItem('token');\n      \n      const response = await axios.post(\n        `${API_URL}/users/kyc-simplified`, \n        formData,\n        {\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${token}`\n          }\n        }\n      );\n      \n      setSuccess('Document IDs submitted successfully. Your KYC verification is pending review.');\n      \n      // Update the user context with new verification status\n      setUser({\n        ...user,\n        verificationStatus: 'pending'\n      });\n      \n      // Redirect to dashboard after 3 seconds\n      setTimeout(() => {\n        navigate('/dashboard');\n      }, 3000);\n      \n    } catch (err) {\n      setError(err.response?.data?.message || err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n  // If auth context is still loading or no user exists, don't render the form yet\n  if (!user) {\n    return null;\n  }\n  \n  return (\n    <Container className=\"py-5\">\n      <Card>\n        <Card.Header as=\"h4\" className=\"text-center bg-primary text-white\">\n          KYC Verification\n        </Card.Header>\n        <Card.Body>\n          {error && <Alert variant=\"danger\">{error}</Alert>}\n          {success && <Alert variant=\"success\">{success}</Alert>}\n          \n          <Card.Text className=\"mb-4\">\n            To continue with our services, we need to verify your identity. Please provide the following document IDs:\n          </Card.Text>\n          \n          <Form onSubmit={handleSubmit}>\n            <Row className=\"mb-4\">\n              <Col md={4}>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>Aadhar Card Number</Form.Label>\n                  <Form.Control\n                    type=\"text\"\n                    name=\"aadharId\"\n                    value={formData.aadharId}\n                    onChange={handleChange}\n                    placeholder=\"Enter 12-digit Aadhar number\"\n                    maxLength={12}\n                    required\n                  />\n                  <Form.Text className=\"text-muted\">\n                    Your 12-digit unique Aadhar identification number\n                  </Form.Text>\n                </Form.Group>\n              </Col>\n              \n              <Col md={4}>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>PAN Card Number</Form.Label>\n                  <Form.Control\n                    type=\"text\"\n                    name=\"panId\"\n                    value={formData.panId}\n                    onChange={handleChange}\n                    placeholder=\"Enter 10-character PAN\"\n                    maxLength={10}\n                    required\n                  />\n                  <Form.Text className=\"text-muted\">\n                    Your 10-character Permanent Account Number\n                  </Form.Text>\n                </Form.Group>\n              </Col>\n              \n              <Col md={4}>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>Income Proof Reference</Form.Label>\n                  <Form.Control\n                    type=\"text\"\n                    name=\"incomeProofId\"\n                    value={formData.incomeProofId}\n                    onChange={handleChange}\n                    placeholder=\"Enter income document reference\"\n                    required\n                  />\n                  <Form.Text className=\"text-muted\">\n                    Tax filing number or salary slip reference\n                  </Form.Text>\n                </Form.Group>\n              </Col>\n            </Row>\n            \n            <div className=\"text-center mt-4\">\n              <Button \n                type=\"submit\" \n                variant=\"primary\" \n                size=\"lg\"\n                disabled={loading || !formData.aadharId || !formData.panId || !formData.incomeProofId}\n                className=\"px-5\"\n              >\n                {loading ? 'Submitting...' : 'Submit Document IDs'}\n              </Button>\n            </div>\n          </Form>\n        </Card.Body>\n      </Card>\n    </Container>\n  );\n};\n\nexport default KycSubmission;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}